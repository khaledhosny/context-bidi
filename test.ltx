\documentclass{article}

\usepackage{fontspec}
\usepackage{unicode-math}
\usepackage[
  rtldocument,
  rtlmath,
  ]{luabidi}

\setmainfont[Script=Arabic]{Amiri}
\setmathfont[RawFeature={+rtlm;+rtla}]{XITS Math}

\begin{document}

\title{تجربة حزمة الكتابة من اليمين لليسار}
\author{خالد حسني\\\texttt{khaledhosny@eglug.org}}
\date{\today}
\maketitle
\tableofcontents

\section{اختبار}
\def\TEST{أبجد () هوز ab()cd حطي g كلمن ١٢٣٤٥ سعفص قرشت.}

\TEST

أبجد () هوز ab()cd حطي g كلمن {\luatextextdir TRT ١٢٣٤٥} سعفص {\luatextextdir TLT قرشت}.

\section{الرياضيات}

أهلا \(123 + 456 = (579) \sum^{123}_{1+2+3}\)

\subsection{Display math}

\[
123 + 456 = (579) \sum^{123}_{1+2+3}
\]

\halign{\hfil\it # & # \hfil\cr
3 cl & \TEST\cr
2 cl & \TEST\cr
1.5 cl & \TEST\cr}

\end{document}
