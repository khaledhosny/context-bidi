\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{luadirections}
    [2010/12/15 v0.002 Higher level interface to LuaTeX's multidirectional support]

\RequirePackage{luatexbase}

\directlua{
    bidi            = bidi or { }
    bidi.chardata   = dofile(kpse.find_file("chardata.lua"))

    require("bidi")

    function bidi.enable()
       luatexbase.add_to_callback("pre_linebreak_filter", bidi.process, "BiDi processing (pre_line)", 1)
       luatexbase.add_to_callback("hpack_filter",         bidi.process, "BiDi processing (hpack)"   , 1)
    end

    function bidi.disable()
       luatexbase.remove_from_callback("pre_linebreak_filter", bidi.process, "BiDi processing (pre_line)")
       luatexbase.remove_from_callback("hpack_filter",         bidi.process, "BiDi processing (hpack)")
    end
}

\def\bidion{\directlua{bidi.enable()}}
\def\bidioff{\directlua{bidi.disable()}}

\endinput
